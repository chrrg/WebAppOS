(function(){var o={};o.config={version:"/webappos/api/os/v.php",auth:"/webappos/api/os/a.php",check:"/webappos/api/os/c.php",OSAppId:"7304e2ba4ad4d653334f88544533f937693d9edc",minVersion:14991,startAppId:"dea93ba952214d7026b5396eebe0706c06fb2b02",defaultApp:[],websocket:null,websocket_pushAppId:null,data:null};o.config.domain=window.location.host;if(/^\d+\.\d+\.\d+\.\d+:?\d*$/.test(o.config.domain)||/^localhost:?\d*$/.test(o.config.domain)){console.error("WebAppOS: A domain name is required for WebAppOS. Such as www.xxx.cn.");console.error("WebAppOS: Will not start until the error is fixed");return;}
o.config.subDomain=o.config.domain.substring(o.config.domain.indexOf(".")+1);if(o.config.subDomain.indexOf(":")>=0)
o.config.subDomain=o.config.subDomain.substring(0,o.config.subDomain.indexOf(":"));o.db=function(){"use strict";var a,e={connect:function(b){if(b){if(!("indexedDB"in window))return f.connect(b),void 0;d=this,a=indexedDB.open("chdb"),a.onupgradeneeded=function(){a.result.createObjectStore("kv")},a.onerror=function(a){a.preventDefault()},a.onsuccess=function(a){e.db=a.target.result,e.setItem("hello","world",function(){e.getItem("hello",function(a){"world"==a?b(e.db):f.connect(b)})})}}},setItem:function(a,b,c){if(b===null)b=void 0;var d=this.db.transaction("kv","readwrite").objectStore("kv"),e=d.put(b,a);c&&(e.onsuccess=function(){c(b)},e.onerror=function(){c()})},getItem:function(a,b){var c,d;b&&(c=this.db.transaction("kv","readonly").objectStore("kv"),d=c.get(a),d.onsuccess=function(){var a=d.result;void 0===a&&(a=null),b(a)},d.onerror=function(){b()})},removeItem:function(a,b){var c=this.db.transaction("kv","readwrite"),d=c.objectStore("kv");d.delete(a),b&&(c.oncomplete=function(){b(null)},c.onerror=c.onabort=function(){b()})},iterate:function(a,b){var c,d;a&&(c=this.db.transaction("kv","readonly").objectStore("kv"),d=c.openCursor(),d.onsuccess=function(){var e,f,c=d.result;c?(e=c.key,f=c.value,void 0===a(e,f)?c.continue():b&&b(null)):b&&b(null)},d.onerror=function(){b&&b()})},clear:function(a){var b=this.db.transaction("kv","readwrite").objectStore("kv"),c=b.clear();a&&(c.onsuccess=function(){a(null)},c.onerror=c.onabort=function(){a()})}},f={connect:function(a){if(a){if(!("openDatabase"in window))return g.connect(a),void 0;d=this,this.db=openDatabase("chdb","","chWebOS",4980736),this.db.transaction(function(b){b.executeSql("CREATE TABLE IF NOT EXISTS chdb (id INTEGER PRIMARY KEY, key unique, value)",[],function(){f.setItem("hello","world",function(){f.getItem("hello",function(b){"world"==b?a(e.db):g.connect(a)})})},function(){g.connect(a)})})}},setItem:function(a,b,c){this.db.transaction(function(d){d.executeSql("INSERT OR REPLACE INTO chdb (key, value) VALUES (?, ?)",[a,JSON.stringify(b)],function(){c&&c(b)},function(){c&&c()})},function(){c&&c()})},getItem:function(a,b){b&&this.db.transaction(function(c){c.executeSql("SELECT * FROM chdb WHERE key = ? LIMIT 1",[a],function(a,c){b(c.rows.length?JSON.parse(c.rows.item(0).value):null)},function(){b()})})},removeItem:function(a,b){this.db.transaction(function(c){c.executeSql("DELETE FROM chdb WHERE key = ?",[a],function(){b&&b(null)},function(){b&&b()})})},iterate:function(a,b){a&&this.db.transaction(function(c){c.executeSql("SELECT * FROM chdb",[],function(c,d){var g,h,e=d.rows,f=e.length;for(g=0;f>g;g++)if(h=e.item(g),void 0!==a(h.key,JSON.parse(h.value)))return b&&b(null),void 0;b&&b(null)})})},clear:function(a){this.db.transaction(function(b){b.executeSql("DELETE FROM chdb",[],function(){a&&a(null)},function(){a&&a()})})}},g={connect:function(a){if(a){if(!("localStorage"in window))return console.warn("浏览器不支持本地储存！"),void 0;d=this,console.warn("浏览器正在使用localStorage存储！"),this.db=localStorage,a(this.db)}},setItem:function(a,b,c){this.db.setItem(a,JSON.stringify(b)),c&&c(b)},getItem:function(a,b){b&&b(JSON.parse(this.db.getItem(a)))},removeItem:function(a,b){this.db.removeItem(a),b&&b(null)},iterate:function(a,b){var c,d;if(a){for(c=0;c<this.db.length;c++)if(d=this.db.key(c),void 0!==a(d,this.db.getItem(d)))return b&&b(null),void 0;b&&b(null)}},clear:function(a){for(var b=this.db.length-1;b>=0;b--)this.db.removeItem(this.db.key(b));a&&a(null)}},d=e;return{setItem:function(a,b,c){d.db?d.setItem(a,b,c):d.connect(function(){d.setItem(a,b,c)})},getItem:function(a,b){d.db?d.getItem(a,b):d.connect(function(){d.getItem(a,b)})},removeItem:function(a,b){d.db?d.removeItem(a,b):d.connect(function(){d.removeItem(a,b)})},iterate:function(a,b){d.db?d.iterate(a,b):d.connect(function(){d.iterate(a,b)})},clear:function(a){d.db?d.clear(a):d.connect(function(){d.clear(a)})}}}();+function(){var big=new Array(1024*1024).join("s");o.db.setItem("f",big,function(){o.db.getItem("f",function(big2){o.db.removeItem("f");if(big!==big2)alert("系统存储空间可能不足！请释放部分存储空间，否则可能导致启动白屏等情况！");});});}();var c=function(e){return document.createElement(e)};var d=document;var html=d.documentElement;if(!d.body){var vitualBody=c("body");html.appendChild(vitualBody);var l=c("link");l.setAttribute("rel","icon");l.setAttribute("href","data:;base64,=");d.head.appendChild(l);}
var b=d.body;var h=d.head;b.style.margin="0";html.style.height=b.style.height="100%";var m=c("meta");m.setAttribute("charset","UTF-8");h.appendChild(m);m=c("meta");m.name="viewport";m.content="width=device-width,initial-scale=1,minimum-scale=1,user-scalable=no";h.appendChild(m);var work=o.work=c("div");work.className="CH_work";work.style.width=work.style.height="100%";var sys=o.sys=c("div");sys.className="sys";sys.style.position="fixed";sys.style.width=sys.style.height="100%";work.appendChild(sys);var appList=o.appList=c("div");appList.className="appList";appList.style.position="fixed";appList.style.width=appList.style.height="100%";work.appendChild(appList);var fullscreen=o.fullscreen=c("div");fullscreen.id="fullscreen";work.appendChild(fullscreen);b.appendChild(work);o.s=o.db.setItem;o.g=o.db.getItem;o.randomChar=function(len){len=len||32;var $chars="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678";var maxPos=$chars.length;var pwd="";for(var i=0;i<len;i++)pwd+=$chars.charAt(Math.floor(Math.random()*maxPos));return pwd;};var OSAppId=o.config.OSAppId;o.request=function(url,post,fn){var a=new XMLHttpRequest();a.open(post?"POST":"GET",url,true);a.onreadystatechange=function(){if(a.readyState==4&&a.status==200||a.status==304){fn(a.responseText);}};if(post)a.setRequestHeader("Content-Type","application/x-www-form-urlencoded");a.send(post);}
o.g("ch:deviceId",function(data){if(!data){o.deviceId=o.randomChar(16);o.s("ch:deviceId",o.deviceId);}else
o.deviceId=data;var init_system=function(h1,h2){sys.innerHTML=h1;var app=function(s){s.onLoad({v:2});}
eval(h2);};o.g("ch:app:ver:"+OSAppId,function(v){if(v&&v>=o.config.minVersion){o.g("ch:app:html:"+OSAppId,function(h){o.g("ch:app:js:"+OSAppId,function(j){init_system(h,j);});});}else{o.request(o.config.version,"prog="+OSAppId+"&device="+o.deviceId,function(s){try{s=JSON.parse(s);}catch(e){}
if(s&&s.ver){s=s.ver;var code_html,code_js;var finish=function(){o.s("ch:app:json:"+OSAppId,s.data);o.s("ch:app:ver:"+OSAppId,s.version|0);init_system(code_html,code_js);};o.request(s.html,null,function(h){o.s("ch:app:html:"+OSAppId,h);code_html=h;if(code_js)finish();});o.request(s.js,null,function(h){o.s("ch:app:js:"+OSAppId,h);code_js=h;if(code_html)finish();});}});}});});return o;})();